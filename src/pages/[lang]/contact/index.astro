---
import { Icon as AstroIcon } from 'astro-icon/components'
import Button from '../../../components/ui/button'
import Input from '../../../components/ui/input'
import sendIcon from '../../../icons/send-icon.svg'
import Layout from '../../../layouts/Layout.astro'
import SectionLayout from '../../../layouts/SectionLayout.astro'
import styles from './contact.module.scss'
import { Tooltip } from '../../../components/ui/tooltip'
import { actions } from 'astro:actions'
import { getLangFromUrl } from '../../../i18n/utils'
import { ui } from '../../../i18n/ui'

const emailResult = Astro.getActionResult(actions.sendEmail)

if (emailResult?.data) {
  Astro.redirect('/')
}

if (emailResult?.error) {
  console.error(emailResult?.error.message)
}

const lang = getLangFromUrl(Astro.url)
const t = ui[lang]
---

<Layout>
  <SectionLayout title={t.contact.title}>
    <main class={styles.container}>
      <section class={styles.info}>
        <h3>{t.contact.subtitle}</h3>
        <p>{t.contact.description}</p>
        <div class={styles.socialMediaContainer}>
          <Tooltip
            content='Linkedin'
            client:load
          >
            <a
              href='https://linkedin.com/in/hectormtg'
              target='_blank'
            >
              <AstroIcon name='linkedin-icon' /></a
            >
          </Tooltip>
        </div>
      </section>

      <form
        class={styles.form}
        id='contact-form'
        action={actions.sendEmail}
        method='post'
      >
        <Input
          placeholder={t.contact.name}
          name='name'
        />
        <Input
          placeholder={t.contact.email}
          type='email'
          name='email'
        />
        <Input
          placeholder={t.contact.subject}
          name='subject'
        />
        <Input
          placeholder={t.contact.message}
          multiline
          name='message'
        />
        <Button
          type='submit'
          endIconSrc={sendIcon.src}
        >
          {t.contact.cta}
        </Button>
      </form>
    </main>
  </SectionLayout>
</Layout>
